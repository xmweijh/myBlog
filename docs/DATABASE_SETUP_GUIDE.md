# ğŸ—„ï¸ MyBlog æ•°æ®åº“é…ç½®å®ŒæˆæŒ‡å—

> é˜¶æ®µ2å¼€å±€ï¼šæˆåŠŸé…ç½® Prisma + SQLiteï¼Œå®Œæˆæ•°æ®æ¨¡å‹è®¾è®¡å’Œç§å­æ•°æ®å¡«å……

---

## ğŸ‰ å®Œæˆæˆæœ

### âœ… æ•°æ®åº“é…ç½®çŠ¶æ€

- **ORM**: Prisma v5.22.0
- **æ•°æ®åº“**: SQLite (å¼€å‘ç¯å¢ƒ)
- **è¿æ¥çŠ¶æ€**: âœ… æ­£å¸¸è¿æ¥
- **è¿ç§»çŠ¶æ€**: âœ… å·²å®Œæˆåˆå§‹è¿ç§»
- **ç§å­æ•°æ®**: âœ… å·²å¡«å……å®Œæˆ

### ğŸ“Š æ•°æ®ç»Ÿè®¡ä¸€è§ˆ

| æ•°æ®ç±»å‹ | æ•°é‡ | è¯¦æƒ… |
|---------|------|------|
| ğŸ‘¥ ç”¨æˆ· | 3 ä¸ª | 1 ç®¡ç†å‘˜ + 2 æµ‹è¯•ç”¨æˆ· |
| ğŸ“ æ–‡ç«  | 4 ç¯‡ | 3 å·²å‘å¸ƒ + 1 è‰ç¨¿ |
| ğŸ“‚ åˆ†ç±» | 5 ä¸ª | å‰ç«¯ã€åç«¯ã€å…¨æ ˆã€æŠ€æœ¯æ‚è°ˆã€é¡¹ç›®å®æˆ˜ |
| ğŸ·ï¸ æ ‡ç­¾ | 12 ä¸ª | Reactã€Node.jsã€TypeScriptç­‰æŠ€æœ¯æ ‡ç­¾ |
| ğŸ’¬ è¯„è®º | 4 æ¡ | åŒ…å«1æ¡å›å¤è¯„è®º |
| ğŸ‘ ç‚¹èµ | 5 ä¸ª | åˆ†å¸ƒåœ¨3ç¯‡æ–‡ç« ä¸Š |

---

## ğŸ—ï¸ æ•°æ®åº“æ¶æ„è®¾è®¡

### æ ¸å¿ƒæ¨¡å‹å…³ç³»å›¾

```
User (ç”¨æˆ·)
â”œâ”€â”€ articles[] (æ–‡ç«  - ä¸€å¯¹å¤š)
â”œâ”€â”€ comments[] (è¯„è®º - ä¸€å¯¹å¤š)
â””â”€â”€ likes[] (ç‚¹èµ - ä¸€å¯¹å¤š)

Article (æ–‡ç« )
â”œâ”€â”€ author (ä½œè€… - å¤šå¯¹ä¸€)
â”œâ”€â”€ category (åˆ†ç±» - å¤šå¯¹ä¸€)
â”œâ”€â”€ tags[] (æ ‡ç­¾ - å¤šå¯¹å¤šï¼Œé€šè¿‡ArticleTag)
â”œâ”€â”€ comments[] (è¯„è®º - ä¸€å¯¹å¤š)
â””â”€â”€ likes[] (ç‚¹èµ - ä¸€å¯¹å¤š)

Category (åˆ†ç±»)
â””â”€â”€ articles[] (æ–‡ç«  - ä¸€å¯¹å¤š)

Tag (æ ‡ç­¾)
â””â”€â”€ articles[] (æ–‡ç«  - å¤šå¯¹å¤šï¼Œé€šè¿‡ArticleTag)

Comment (è¯„è®º)
â”œâ”€â”€ author (ä½œè€… - å¤šå¯¹ä¸€)
â”œâ”€â”€ article (æ–‡ç«  - å¤šå¯¹ä¸€)
â”œâ”€â”€ parent (çˆ¶è¯„è®º - è‡ªå…³è”)
â””â”€â”€ replies[] (å›å¤ - è‡ªå…³è”)

Like (ç‚¹èµ)
â”œâ”€â”€ user (ç”¨æˆ· - å¤šå¯¹ä¸€)
â””â”€â”€ article (æ–‡ç«  - å¤šå¯¹ä¸€)
```

### å…³é”®è®¾è®¡å†³ç­–

1. **ç”¨æˆ·è§’è‰²ç³»ç»Ÿ**
   - æ”¯æŒ USERã€ADMINã€MODERATOR ä¸‰ç§è§’è‰²
   - ä½¿ç”¨å­—ç¬¦ä¸²æšä¸¾ï¼ˆå…¼å®¹SQLiteï¼‰

2. **æ–‡ç« çŠ¶æ€ç®¡ç†**
   - DRAFT (è‰ç¨¿)ã€PUBLISHED (å·²å‘å¸ƒ)ã€ARCHIVED (å½’æ¡£)
   - æ”¯æŒç½®é¡¶åŠŸèƒ½ (isTop)

3. **è¯„è®ºåµŒå¥—ç»“æ„**
   - æ”¯æŒçˆ¶å­è¯„è®ºå…³ç³»
   - ä¾¿äºå®ç°å›å¤åŠŸèƒ½

4. **æ ‡ç­¾å¤šå¯¹å¤šå…³ç³»**
   - é€šè¿‡ ArticleTag ä¸­é—´è¡¨å®ç°
   - æ”¯æŒæ ‡ç­¾çš„é‡å¤ä½¿ç”¨

---

## ğŸ”Œ API ç«¯ç‚¹ç°çŠ¶

### âœ… å·²å®ç°çš„ç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|------|------|
| `/health` | GET | å¥åº·æ£€æŸ¥ + æ•°æ®åº“è¿æ¥çŠ¶æ€ | âœ… æ­£å¸¸ |
| `/api` | GET | API åŸºç¡€ä¿¡æ¯å’Œç«¯ç‚¹åˆ—è¡¨ | âœ… æ­£å¸¸ |
| `/api/stats` | GET | æ•°æ®ç»Ÿè®¡ä¿¡æ¯ | âœ… æ­£å¸¸ |
| `/api/articles` | GET | æ–‡ç« åˆ—è¡¨ï¼ˆå·²å‘å¸ƒï¼‰ | âœ… æ­£å¸¸ |
| `/api/categories` | GET | åˆ†ç±»åˆ—è¡¨ | âœ… æ­£å¸¸ |
| `/api/tags` | GET | æ ‡ç­¾åˆ—è¡¨ | âœ… æ­£å¸¸ |

### ğŸ“ ç¤ºä¾‹å“åº”

#### GET /api/stats
```json
{
  "success": true,
  "data": {
    "users": 3,
    "articles": 4,
    "categories": 5,
    "tags": 12,
    "comments": 4,
    "likes": 5
  },
  "timestamp": "2025-10-08T04:53:21.979Z"
}
```

#### GET /api/articles
```json
{
  "success": true,
  "data": [
    {
      "id": "cmghig9dt000o55vgikj5gm9b",
      "title": "MyBlog å…¨æ ˆåšå®¢ç³»ç»Ÿå¼€å‘æŒ‡å—",
      "slug": "myblog-fullstack-development-guide",
      "excerpt": "ä»é›¶å¼€å§‹æ„å»ºç°ä»£åŒ–çš„å…¨æ ˆåšå®¢ç³»ç»Ÿ...",
      "status": "PUBLISHED",
      "isTop": true,
      "viewCount": 156,
      "likeCount": 2,
      "author": {
        "id": "cmghig9cm000a55vgfp2jxqjl",
        "username": "admin",
        "avatar": "https://ui-avatars.com/api/?name=Admin&background=3b82f6&color=fff"
      },
      "category": {
        "name": "å…¨æ ˆå¼€å‘",
        "slug": "fullstack",
        "color": "#f59e0b"
      },
      "tags": [...],
      "_count": {
        "comments": 2,
        "likes": 2
      }
    }
  ]
}
```

---

## ğŸ› ï¸ æŠ€æœ¯å®ç°è¦ç‚¹

### 1. Prisma ORM é…ç½®

```typescript
// prisma/schema.prisma å…³é”®é…ç½®
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}
```

### 2. æ•°æ®åº“è¿æ¥ç®¡ç†

```typescript
// src/utils/database.ts - å•ä¾‹æ¨¡å¼
export class DatabaseManager {
  private static instance: DatabaseManager;

  public async testConnection(): Promise<boolean> {
    // è¿æ¥æµ‹è¯•é€»è¾‘
  }

  public async cleanDatabase(): Promise<void> {
    // å¼€å‘ç¯å¢ƒæ•°æ®æ¸…ç†
  }
}
```

### 3. ç±»å‹å®‰å…¨çš„APIå“åº”

```typescript
// ç»Ÿä¸€çš„APIå“åº”æ ¼å¼
export interface ApiResponse<T = any> {
  success: boolean;
  data?: T;
  error?: string;
  message?: string;
  timestamp: string;
}
```

---

## ğŸ“‹ æµ‹è¯•è´¦å·ä¿¡æ¯

| è§’è‰² | é‚®ç®± | å¯†ç  | ç”¨é€” |
|------|------|------|------|
| ç®¡ç†å‘˜ | admin@myblog.com | admin123456 | ç³»ç»Ÿç®¡ç† |
| ç”¨æˆ·1 | john@example.com | user123456 | å‰ç«¯å¼€å‘è€… |
| ç”¨æˆ·2 | jane@example.com | user123456 | å…¨æ ˆå·¥ç¨‹å¸ˆ |

---

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### å³å°†å¼€å§‹çš„ä»»åŠ¡

1. **ğŸ” ç”¨æˆ·è®¤è¯ç³»ç»Ÿ**
   - JWT ä»¤ç‰Œç”Ÿæˆå’ŒéªŒè¯
   - ç”¨æˆ·æ³¨å†Œ/ç™»å½• API
   - å¯†ç åŠ å¯† (bcrypt)
   - æƒé™ä¸­é—´ä»¶

2. **ğŸ“ æ–‡ç« ç®¡ç† API**
   - åˆ›å»ºæ–‡ç«  (POST)
   - æ›´æ–°æ–‡ç«  (PUT)
   - åˆ é™¤æ–‡ç«  (DELETE)
   - æ–‡ç« è¯¦æƒ… (GET)

3. **ğŸ’¬ è¯„è®ºç³»ç»Ÿ API**
   - è¯„è®ºçš„å¢åˆ æ”¹æŸ¥
   - å›å¤åŠŸèƒ½
   - è¯„è®ºæƒé™æ§åˆ¶

### ğŸ”§ å¼€å‘ç¯å¢ƒè¯´æ˜

- **æ•°æ®åº“æ–‡ä»¶**: `backend/prisma/dev.db`
- **è¿ç§»è®°å½•**: `backend/prisma/migrations/`
- **ç§å­è„šæœ¬**: `backend/prisma/seed.ts`
- **ç±»å‹å®šä¹‰**: `backend/src/types/database.ts`

---

## ğŸ’¡ å­¦ä¹ è¦ç‚¹

é€šè¿‡è¿™ä¸ªæ•°æ®åº“é…ç½®é˜¶æ®µï¼Œä½ å·²ç»æŒæ¡äº†ï¼š

1. **ORM æ¦‚å¿µå’Œä½¿ç”¨**
   - Prisma çš„ schema å®šä¹‰
   - æ•°æ®åº“è¿ç§»æµç¨‹
   - ç§å­æ•°æ®ç®¡ç†

2. **æ•°æ®å»ºæ¨¡æœ€ä½³å®è·µ**
   - å…³ç³»å‹æ•°æ®åº“è®¾è®¡
   - å¤–é”®å’Œç´¢å¼•ä½¿ç”¨
   - æ•°æ®ä¸€è‡´æ€§ä¿è¯

3. **ç±»å‹å®‰å…¨å¼€å‘**
   - Prisma ç”Ÿæˆçš„ç±»å‹
   - TypeScript æ¥å£è®¾è®¡
   - API å“åº”è§„èŒƒåŒ–

4. **å¼€å‘ç¯å¢ƒæ­å»º**
   - SQLite çš„ä¼˜åŠ¿å’Œä½¿ç”¨åœºæ™¯
   - å¼€å‘/ç”Ÿäº§ç¯å¢ƒå·®å¼‚
   - Docker å¯é€‰æ–¹æ¡ˆ

---

*ğŸ‰ æ•°æ®åº“åŸºç¡€å·²ç»ç‰¢å›ºï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†æ„å»ºå¼ºå¤§çš„ API ç³»ç»Ÿï¼*
